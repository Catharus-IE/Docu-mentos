name: Observatory Update

on:
  schedule:
    - cron: '0 0 * * *'  # æ¯å¤© UTC æ—¶é—´ 0 ç‚¹è¿è¡Œ
  workflow_dispatch:     # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Update Metadata
        run: |
          #!/bin/bash
          DATE=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
          SAN=$(( $(shuf -i 30-99 -n 1) ))  # ä½¿ç”¨ shuf ç”Ÿæˆéšæœºæ•°

          echo "å½“å‰æ—¶é—´ï¼š${DATE}"
          echo "SAN å€¼ï¼š${SAN}"

          # æ›¿æ¢ README.md ä¸­çš„å†…å®¹
          sed -i '/æœ€åæ ¡å‡†æ—¶é—´ï¼š/{s/æœ€åæ ¡å‡†æ—¶é—´ï¼š.*/æœ€åæ ¡å‡†æ—¶é—´ï¼š${DATE}/;n;s/è­¦å‘Šï¼šæ£€æµ‹åˆ°.*/SAN-${SAN}\/99-critical/}' README.md

      - name: Commit Changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸŒŒ è‡ªåŠ¨æ›´æ–°è§‚æµ‹æ•°æ®"
          branch: main
